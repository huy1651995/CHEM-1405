<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>

    <style>
        .input-from{
            
            padding-left: 20px;
            
        }

    </style>




</head>


<body>
<container>
    <div class="title"><h2>Chem Calculator</h2></div>


    <div class="card" >
       <form class="input-from">
           <div class="form-group">
            <div class="row"> 
                <div class="col-md-4">
                    <label for="Cong thuc">Cong thuc</label>
                </div>       
                <div class="col-md-4">
                    <input type="text" class="form-control" id="cong-thuc" oninput="calculate()">
                <small class="form-text text-muted"> Example: H2O, Ca(OH)2</small>

                </div>
            </div>

            <div class="row"> 
                <div class="col-md-6">
                    <label for="Cong thuc">Molecular weight</label>
                </div>       
                <div class="col-md-6">
                    <input type="text" class="form-control" id="molecular-weight">
                <small class="form-text text-muted"> g/mol</small>

                </div>
            </div>

            <div class="row"> 
                <div class="col-md-6">
                    <label for="Cong thuc">Moles</label>
                </div>       
                <div class="col-md-6">
                    <input type="text" class="form-control" id="moles">
                <small class="form-text text-muted"> mol</small>

                </div>
            </div>

            <div class="row"> 
                <div class="col-md-6">
                    <label for="Cong thuc">Molecules</label>
                </div>       
                <div class="col-md-6">
                    <input type="text" class="form-control" id="cong-thuc">
                <small class="form-text text-muted"> 6.022 x 10^23</small>

                </div>
            </div>
               
            <button type="submit" class="btn btn-primary" onclick="calculate()">Submit</button>
            </div>

       </form>
    </div>
</container>

    

</body>
<footer></footer>

    


<script>

    class Element {
        constructor(name,weight){
            this.name=name;
            this.weight=weight;
        }
    }

    var a = new Element("Ca",20);

    var periodicTable = [
        new Element("Ca",40.078),
        new Element("O",15.999),
        new Element("H",1.0008),
        new Element("C",12.011),
        new Element("P",30.974),
        new Element("Cl",35.45)]

    function calculate() {
        var ct = document.getElementById('cong-thuc').value;

        console.log("ct : ",ct);

        var a = "H";
        var aa = elementDectection(ct)

        var b = periodicTable.filter(w=>w.name=="Ca");

        var ccc = calculateMassAndPercent(aa);

        console.log(ccc);
        

        

    }

    function calculateMassAndPercent(aElement)
    {
        var total = 0;
        var percentArray = [];

        Array.prototype.forEach.call(aElement,e=>{
            var a = periodicTable.filter(w=>w.name==e.element);
            total+=a[0].weight*e.count;            
        })

        
        Array.prototype.forEach.call(aElement,e=>{

            var temp = periodicTable.find(w=>w.name==e.element);

            var percent = ((temp.weight*e.count)*100/total).toFixed(4);

            percentArray.push({"element":e.element,"percent": percent})
        })

        return {"total":total,"percentArray":percentArray};
    }


    /* Input Ca(OH)2
     Output: [{"element":"Ca","count":1},
                {"element":"O","count":2},
                {"element":"H","count":2}]
    */
    function elementDectection(formula){
       var hold = [];
        var index = 1;
        var isOpen = false;
        var isOneTime = true;

        var result = [];

        Array.prototype.forEach.call(formula,e=>{

            if(e.match(/[A-Z]/)) // Uppercase
            {

                hold.push(e);

            }else if(e.match(/[a-z]/)) //lowercase
            {
                if(hold)
                { hold[hold.length-1] += e;   }
            }
            else if(e.match(/[0-9]/)) //Number
            {
                if(isOneTime)
                {
                    var temp = hold[hold.length-1];
                    for(let i = 0;i<e-1;i++)
                    {
                        hold.push(temp);
                    }

                }else{
                    
                    for(let i = 0;i<e;i++)
                    {                                            
                    Array.prototype.forEach.call(hold,el=>{                        
                        result.push(el);
                    })                    
                
                    }
                    hold=[];
                }

                isOneTime = true;

            }
            else if(e=='(')
            {
                if(hold){
                    Array.prototype.forEach.call(hold,el => {
                        result.push(el);
                    });
                    hold=[];
                }
                isOpen = true;
            }else if(e==')' && isOpen)
            {               
                isOneTime = false;
                isOpen=false;
            }
        })


        Array.prototype.forEach.call(hold,e=>{
            result.push(e);
        })

        hold=[];

        var unique = result.filter((v,i,e)=>{return e.indexOf(v)===i;})
        var distinctElement =  [];
        Array.prototype.forEach.call(unique,e=>{

            var count = result.filter(k=>k==e).length;
            distinctElement.push( {"element":e,"count":count}); 
        })

        
        
        return distinctElement;
        
    }


</script>